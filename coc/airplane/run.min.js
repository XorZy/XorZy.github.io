var e=document.getElementById("buffer"),t=e.getContext("2d");function n(e,t){var n,c,o,r,d,s,u,p,m,h,b,f,g,E,x,S,C,A,y=document.createElement("h1");y.innerText=e[0],n=document.createElement("p"),(c=document.createElement("p")).innerText="Collisions: 0",(o=document.createElement("p")).innerText="Turn: 0",r=document.createElement("canvas"),d=document.createElement("table"),r.setAttribute("width","640"),r.setAttribute("height","640"),s=r.getContext("2d"),(u=document.createElement("button")).innerText="Next",u.setAttribute("class","btn btn-success"),(p=document.createElement("button")).innerText="Back",p.setAttribute("class","btn btn-danger"),(m=document.createElement("button")).innerText="Auto",m.setAttribute("class","btn btn-warning"),(h=document.createElement("button")).innerText="Reset/Stop",h.setAttribute("class","btn btn-secondary"),(b=document.createElement("table")).setAttribute("width","400px"),f=document.createElement("tr"),b.appendChild(f),(g=document.createElement("td")).appendChild(n),f.appendChild(g),(E=document.createElement("td")).appendChild(o),f.appendChild(E),(x=document.createElement("td")).appendChild(c),f.appendChild(x),t.appendChild(y),t.appendChild(r),t.appendChild(b),d.appendChild(p),d.appendChild(u),d.appendChild(m),d.appendChild(h),t.appendChild(d),S=0,C=Math.min(r.width/e[1][0],r.height/e[1][1]),(A={}).turn=0,A.selection=[-1,-1],A.oppositePlanes=[],A.collisionSpot=[-1,-1],A.planeData=v(e[1][0],e[1][1],e[2]),A.ctx=s,A.canvas=r,A.width=e[1][0],A.height=e[1][1],A.txtCollisions=c,A.txtLocation=n,A.txtTurn=o,A.cellSize=C,A.playingAnimation=!1,A.autoPlayButton=m,r.addEventListener("mouseleave",e=>{A.selection=[-1,-1],A.oppositePlanes=[],A.collisionSpot=[-1,-1],i(A)}),r.addEventListener("mousemove",e=>{var t,l,a,v,c=Math.floor(e.offsetX/C),o=Math.floor(e.offsetY/C);n.innerText="X:"+c+" Y:"+o,c==A.selection[0]&&o==A.selection[1]||(A.selection=[c,o],t=[],l=[-1,-1],a=A.planeData[A.turn][1],null!=(v=_.find(a,(function(e){return e[0]==c&&e[1]==o})))&&A.planeData.forEach(e=>{var n,i=_.find(e[1],(function(e){return"X"==e[2]&&_.some(e[4],(function(e){return e[4]==v[4]}))}));null!=i&&(l=[i[0],i[1]],n=_.map(i[4],(function(e){return e[4]})),t=_.filter(a,(function(e){return _.includes(n,e[4])})))}),A.collisionSpot=l,A.oppositePlanes=t,i(A))}),u.addEventListener("click",(function(){a(A,1)})),p.addEventListener("click",(function(){a(A,-1)})),m.addEventListener("click",(function(){A.turn=0,i(A),m.disabled=!0,A.playingAnimation=!0,window.setTimeout((function(){l(A)}),1e3)})),h.addEventListener("click",(function(){A.turn=0,m.disabled=!1,A.playingAnimation=!1,i(A)})),i(A)}function i(e){var t,n;window.requestAnimationFrame((function(){c(e)})),e.txtTurn.innerText="Turn: "+e.turn,t=e.planeData[e.turn][0],e.txtCollisions.innerText="Collisions: "+t,e.turn>0&&t!=(n=e.planeData[e.turn-1][0])&&(e.txtCollisions.innerText+=" (+"+(t-n)+")")}function l(e){e.playingAnimation&&a(e,1),e.turn+1<e.planeData.length&&e.playingAnimation?window.setTimeout((function(){l(e)}),1e3):e.autoPlayButton.disabled=!1}function a(e,t){e.turn+t>=0&&e.turn+t<e.planeData.length&&(e.turn+=t,i(e))}function v(e,t,n){for(var i,l=0,a=_.map(n,(function(e){return[e[0],e[1],e[2],"#"+Math.floor(16777215*Math.random()).toString(16),l++]})),v=[],c=0;a.length>0;)v.push([c,JSON.parse(JSON.stringify(a))]),a.forEach(e=>{var t=e[2];">"==t&&e[0]++,"<"==t&&e[0]--,"^"==t&&e[1]--,"v"==t&&e[1]++}),a=a.filter(n=>"X"!=n[2]&&n[0]>=0&&n[0]<e&&n[1]>=0&&n[1]<t),i=_.groupBy(a,(function(e){return[e[0],e[1]]})),Object.keys(i).forEach(e=>{var t,n=i[e];n.length>1&&(c++,n.forEach(e=>{_.pull(a,e)}),t=e.split(","),a.push([parseInt(t[0]),parseInt(t[1]),"X","#FF0000",n]))});return v}function c(n){var i,l,a,v,c,o,r,d,s,u;for(n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),i=.8*n.cellSize,l=.8*n.cellSize,a=n.cellSize/2-i/2,v=n.cellSize/2-l/2,c=document.getElementById("planeUp"),o=document.getElementById("planeLeft"),r=document.getElementById("planeRight"),d=document.getElementById("planeDown"),s=0;s<n.height;s++)for(u=0;u<n.width;u++)s==n.selection[1]&&u==n.selection[0]?(n.ctx.beginPath(),n.ctx.fillStyle="#FF0000",n.ctx.fillRect(u*n.cellSize,s*n.cellSize,n.cellSize,n.cellSize),n.ctx.stroke()):s==n.collisionSpot[1]&&u==n.collisionSpot[0]?n.ctx.drawImage(collision,u*n.cellSize+a,s*n.cellSize+v,i,l):(n.ctx.beginPath(),n.ctx.rect(u*n.cellSize,s*n.cellSize,n.cellSize,n.cellSize),n.ctx.stroke());n.oppositePlanes.forEach(e=>{n.ctx.beginPath(),n.ctx.fillStyle="#FFFF00",n.ctx.fillRect(e[0]*n.cellSize,e[1]*n.cellSize,n.cellSize,n.cellSize),n.ctx.stroke()}),n.planeData[n.turn][1].forEach(s=>{t.globalCompositeOperation="source-over",n.ctx.fillStyle="#FFFFFF",t.clearRect(0,0,128,128),"^"==s[2]&&t.drawImage(c,0,0,i,l),"<"==s[2]&&t.drawImage(o,0,0,i,l),">"==s[2]&&t.drawImage(r,0,0,i,l),"v"==s[2]&&t.drawImage(d,0,0,i,l),"X"==s[2]&&t.drawImage(collision,0,0,i,l),t.globalCompositeOperation="source-in",t.fillStyle=s[3],t.fillRect(0,0,i,l),n.ctx.drawImage(e,0,0,i,l,s[0]*n.cellSize+a,s[1]*n.cellSize+v,i,l)})}window.onload=function(){var e,t,i;cases=[["One collision ",[5,5],[[2,1,"v"],[1,2,">"]]],["Close encounter",[8,8],[[3,1,"v"],[2,3,">"]]],["Catastrophy",[6,6],[[1,0,"v"],[3,0,"v"],[5,0,"v"],[0,1,">"],[2,1,">"],[4,1,">"],[1,2,"v"],[3,2,"v"],[5,2,"v"],[0,3,">"],[2,3,">"],[4,3,">"],[1,4,"v"],[3,4,"v"],[5,4,"v"],[0,5,">"],[2,5,">"],[4,5,">"]]],["Chained reaction",[9,9],[[4,0,"v"],[4,1,"v"],[4,2,"v"],[1,3,"v"],[4,3,"v"],[0,4,">"],[1,4,">"],[2,4,">"],[3,4,">"]]],["Left and Up",[10,10],[[8,2,"<"],[7,3,"^"],[8,3,"<"],[4,4,"<"],[3,5,"^"],[4,5,"<"],[7,5,"^"],[1,7,"^"],[2,8,"<"],[7,8,"<"],[6,9,"^"]]],["All directions",[8,6],[[4,1,"v"],[2,2,">"],[6,2,"<"],[4,3,"^"]]],["4-in-one",[6,6],[[2,1,"v"],[1,2,">"],[3,2,"<"],[2,3,"^"]]],["Simultaneous movement",[6,6],[[2,1,">"],[3,1,"<"],[2,3,">"],[3,3,"<"],[5,4,"v"],[5,5,"^"]]],["Crowded airspace",[15,15],[[1,0,"v"],[2,0,">"],[3,0,"v"],[4,0,"v"],[5,0,">"],[6,0,"v"],[7,0,">"],[8,0,"v"],[9,0,"v"],[11,0,">"],[12,0,"v"],[0,1,"v"],[1,1,">"],[3,1,">"],[5,1,">"],[6,1,"v"],[9,1,">"],[10,1,">"],[11,1,"v"],[12,1,"v"],[1,2,"v"],[2,2,">"],[4,2,">"],[5,2,"v"],[7,2,"v"],[8,2,">"],[10,2,">"],[11,2,">"],[12,2,"v"],[13,2,"v"],[0,3,">"],[1,3,"v"],[2,3,">"],[4,3,"v"],[5,3,"v"],[8,3,"v"],[10,3,">"],[12,3,"v"],[14,3,">"],[0,4,">"],[2,4,"v"],[3,4,"v"],[4,4,">"],[7,4,"v"],[9,4,">"],[10,4,">"],[12,4,"v"],[13,4,">"],[14,4,">"],[2,5,"v"],[3,5,">"],[4,5,">"],[6,5,"v"],[8,5,">"],[10,5,"v"],[11,5,">"],[12,5,">"],[14,5,">"],[0,6,"v"],[1,6,">"],[2,6,">"],[4,6,">"],[5,6,">"],[7,6,">"],[10,6,"v"],[11,6,"v"],[12,6,">"],[13,6,">"],[0,7,">"],[1,7,">"],[2,7,"v"],[3,7,">"],[5,7,">"],[7,7,">"],[8,7,">"],[9,7,"v"],[10,7,"v"],[11,7,">"],[12,7,">"],[13,7,">"],[1,8,">"],[3,8,">"],[4,8,"v"],[5,8,"v"],[6,8,">"],[7,8,"v"],[8,8,"v"],[9,8,">"],[10,8,"v"],[11,8,"v"],[12,8,">"],[14,8,"v"],[1,9,">"],[2,9,"v"],[3,9,"v"],[4,9,">"],[7,9,">"],[8,9,"v"],[11,9,"v"],[12,9,"v"],[14,9,"v"],[1,10,"v"],[2,10,">"],[4,10,">"],[5,10,"v"],[6,10,"v"],[11,10,"v"],[13,10,"v"],[14,10,"v"],[0,11,"v"],[3,11,">"],[4,11,">"],[5,11,">"],[6,11,"v"],[7,11,">"],[8,11,">"],[9,11,"v"],[11,11,"v"],[12,11,"v"],[13,11,"v"],[14,11,"v"],[0,12,"v"],[1,12,">"],[2,12,">"],[3,12,"v"],[5,12,">"],[6,12,"v"],[7,12,"v"],[8,12,">"],[11,12,">"],[12,12,">"],[13,12,">"],[0,13,"v"],[1,13,"v"],[2,13,"v"],[3,13,"v"],[6,13,">"],[7,13,"v"],[8,13,"v"],[9,13,"v"],[10,13,"v"],[11,13,">"],[12,13,">"],[13,13,"v"],[0,14,"v"],[1,14,">"],[2,14,"v"],[4,14,">"],[5,14,"v"],[6,14,"v"],[7,14,">"],[8,14,">"],[9,14,"v"],[10,14,">"],[11,14,"v"],[13,14,"v"],[14,14,">"]]],["Tiny Space",[1,1],[[0,0,">"]]],["Large space",[30,25],[[10,0,"v"],[12,0,">"],[18,0,"v"],[24,0,">"],[4,1,"v"],[9,1,">"],[12,1,"v"],[13,1,">"],[6,2,"v"],[12,2,">"],[29,2,"v"],[7,3,">"],[12,3,"v"],[25,3,"v"],[1,4,"v"],[4,4,">"],[23,4,"v"],[17,5,"v"],[25,5,"v"],[9,6,"v"],[10,6,"v"],[25,6,">"],[25,7,">"],[25,8,"v"],[26,9,">"],[3,10,"v"],[25,10,"v"],[28,10,"v"],[13,11,">"],[23,11,"v"],[24,11,">"],[11,14,">"],[12,14,">"],[22,14,"v"],[24,14,"v"],[17,15,">"],[18,15,">"],[27,15,"v"],[9,16,"v"],[24,16,">"],[28,16,"v"],[1,17,"v"],[23,17,"v"],[29,17,">"],[12,18,"v"],[14,18,"v"],[18,18,">"],[1,19,"v"],[5,19,"v"],[18,19,"v"],[19,19,"v"],[1,21,">"],[3,21,">"],[7,21,">"],[28,21,"v"],[6,22,"v"],[12,22,">"],[17,22,"v"],[5,23,"v"],[6,23,">"],[9,23,">"],[16,23,">"],[1,24,"v"],[2,24,">"],[6,24,"v"],[8,24,">"],[22,24,">"]]],["Final test",[13,13],[[0,0,"^"],[1,0,">"],[2,0,">"],[3,0,"^"],[4,0,">"],[5,0,"<"],[7,0,"v"],[8,0,"^"],[11,0,">"],[0,1,"v"],[1,1,"<"],[2,1,"v"],[3,1,"v"],[4,1,"^"],[5,1,"<"],[7,1,"v"],[8,1,"^"],[11,1,"v"],[0,2,">"],[2,2,">"],[3,2,"v"],[4,2,"v"],[5,2,"^"],[6,2,"<"],[7,2,"v"],[8,2,">"],[9,2,"v"],[10,2,"^"],[12,2,"^"],[0,3,"v"],[1,3,">"],[2,3,"<"],[3,3,"v"],[4,3,">"],[6,3,"<"],[7,3,">"],[8,3,"v"],[9,3,">"],[10,3,"<"],[11,3,">"],[12,3,"<"],[1,4,"<"],[2,4,"v"],[3,4,"v"],[5,4,"v"],[6,4,"v"],[8,4,"v"],[9,4,"v"],[10,4,"<"],[11,4,">"],[12,4,"^"],[0,5,"^"],[1,5,"v"],[2,5,"^"],[3,5,"^"],[4,5,"^"],[5,5,"v"],[6,5,"^"],[7,5,">"],[9,5,"^"],[10,5,"v"],[11,5,"<"],[12,5,"<"],[2,6,">"],[3,6,">"],[4,6,"<"],[6,6,"^"],[8,6,">"],[9,6,"^"],[10,6,"^"],[11,6,"<"],[12,6,"v"],[1,7,">"],[2,7,"<"],[4,7,"v"],[5,7,"<"],[6,7,">"],[8,7,"v"],[9,7,">"],[10,7,"^"],[11,7,"<"],[1,8,">"],[2,8,">"],[3,8,"<"],[5,8,"v"],[6,8,"v"],[7,8,"<"],[8,8,"<"],[9,8,"^"],[10,8,"^"],[11,8,"<"],[0,9,">"],[1,9,"v"],[4,9,"v"],[5,9,"<"],[6,9,"^"],[8,9,"v"],[9,9,"<"],[11,9,"v"],[12,9,">"],[0,10,"v"],[1,10,">"],[2,10,"^"],[3,10,"v"],[5,10,"<"],[9,10,"v"],[10,10,"v"],[11,10,"v"],[12,10,"<"],[0,11,"^"],[1,11,"v"],[2,11,"v"],[4,11,"<"],[5,11,"^"],[6,11,"^"],[7,11,">"],[9,11,"<"],[10,11,"<"],[11,11,"<"],[12,11,"v"],[0,12,"v"],[1,12,"^"],[2,12,"^"],[4,12,"^"],[5,12,"^"],[6,12,"<"],[7,12,"v"],[8,12,"v"],[9,12,"^"],[10,12,"^"],[11,12,"^"]]]],e=0,(t=document.createElement("div")).setAttribute("class","accordion"),t.setAttribute("id","acc1"),document.getElementById("container").appendChild(t),i=0,cases.forEach(e=>{var l,a,v,c,o=document.createElement("div");o.setAttribute("class","accordion-item"),(l=document.createElement("h2")).setAttribute("class","accordion-header"),l.setAttribute("id","heading"+i),(a=document.createElement("button")).setAttribute("class","accordion-button collapsed"),a.setAttribute("type","button"),a.setAttribute("data-bs-toggle","collapse"),a.setAttribute("data-bs-target","#collapse"+i),a.setAttribute("aria-expanded","false"),a.setAttribute("aria-controls","collapse"+i),a.innerText=e[0],l.appendChild(a),(v=document.createElement("div")).setAttribute("id","collapse"+i),v.setAttribute("class","accordion-collapse collapse"),v.setAttribute("aria-labelledby","heading"+i),v.setAttribute("data-bs-parent","#acc1"),(c=document.createElement("div")).setAttribute("class","accordion-body"),v.appendChild(c),o.appendChild(l),o.appendChild(v),n(e,c),t.appendChild(o),i++})};